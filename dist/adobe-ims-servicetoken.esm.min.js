/*!
 2023 Jason Mulligan <jason.mulligan@avoidwork.com>
 @version 2.0.2
*/
import{FormData as e}from"form-data";import{fetch as t}from"node-fetch";import o from"murmurhash3js";const n="undefined"==typeof FormData?e:FormData,r="undefined"==typeof fetch?t:fetch,s=o.x64.hash128,a=new Map,i="function"==typeof structuredClone?structuredClone:e=>JSON.parse(JSON.stringify(e));module.exports=async function({url:e="https://ims-na1.adobelogin.com/ims/token",grant_type:t="authorization_code",client_id:o="",client_secret:c="",code:d="",jwt_token:p=""}={}){const m=s(`${e}|${o}|${t}`);let f;if(!1===a.has(m)){const s=new n;let h;t.length>0&&s.append("grant_type",t),s.append("client_id",o),s.append("client_secret",c),d.length>0&&s.append("code",d),p.length>0&&s.append("jwt_token",p);try{h=await r(e,{method:"POST",headers:s.getHeaders(),body:s})}catch(e){h={ok:!1,statusText:e.message||e,json:async()=>({error:h.statusText,error_description:e.message}),text:async()=>e.message||e}}const u=await h.json();if(!h.ok)throw new Error(`[${h.status}] ${u.error}: ${u.error_description}`);a.set(m,u.access_token),f=i(u.access_token),void 0!==u.expires_in&&setTimeout((()=>a.delete(m)),u.expires_in)}else f=i(a.get(m));return f};//# sourceMappingURL=adobe-ims-servicetoken.esm.min.js.map
